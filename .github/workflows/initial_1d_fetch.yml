name: Initial 1D Klines Fetch

on:
  workflow_dispatch:
    inputs:
      batch_size:
        description: 'Number of symbols to process in parallel (1-10)'
        required: false
        default: '5'

jobs:
  initial-1d-fetch:
    runs-on: ubuntu-latest
    timeout-minutes: 480  # 8 hours max
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas pyarrow huggingface-hub requests numpy
      
      - name: Run Initial 1D Fetcher
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python << 'EOF'
          import os
          from initial_1d_fetcher import Initial1dFetcher
          
          hf_token = os.environ.get('HF_TOKEN')
          if not hf_token:
              print('Error: HF_TOKEN not set')
              exit(1)
          
          sep = '=' * 70
          print(f'\n{sep}')
          print('Initial 1D Klines Fetch - Starting')
          print(f'{sep}\n')
          
          fetcher = Initial1dFetcher(hf_token=hf_token)
          success_count, failed_count = fetcher.process_all_1d()
          fetcher.print_summary(success_count, failed_count)
          EOF
      
      - name: Print Completion Summary
        if: always()
        run: |
          echo "\n==============================================="
          echo "Initial 1D Fetch Workflow Completed"
          echo "==============================================="
          echo "Check the logs above for detailed results"
          echo "Your data is available at:"
          echo "https://huggingface.co/datasets/zongowo111/v2-crypto-ohlcv-data"
          echo "===============================================\n"
